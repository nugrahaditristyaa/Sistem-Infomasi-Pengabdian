<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisasi KPI - Radar Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .chart-container {
            width: 100%;
            max-width: 800px;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px HKI12px rgba(0, 0, 0, 0.08);
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
        }
    </style>
</head>
<body>

    <div class="chart-container">
        <h2>Ringkasan Capaian KPI (2024)</h2>
        <canvas id="kpiRadarChart"></canvas>
    </div>

    <script>
        // 3. Data KPI Anda (diambil dari gambar)
        const kpiData = [
            { kode: 'PGB.I.1.1', indikator: 'Memenuhi luaran (>=80%) sesuai proposal', realisasi: 100.0, target: 80.0, satuan: '%' },
            { kode: 'PGB.I.5.6', indikator: 'Peningkatan jumlah (>= 10 %) per tahun', realisasi: 0.0, target: 10.0, satuan: '%' },
            { kode: 'PGB.I.7.4', indikator: 'Mendapat pendanaan eksternal (>=30%)', realisasi: 0.0, target: 30.0, satuan: '%' },
            { kode: 'PGB.I.7.9', indikator: 'Peningkatan jumlah proposal yang diterima (>=10%)', realisasi: 0.0, target: 10.0, satuan: '%' },
            { kode: 'IKT.I.5.g', indikator: 'Digunakan dalam proses pembelajaran (>= 5 %)', realisasi: 100.0, target: 5.0, satuan: '%' },
            { kode: 'IKT.I.5.h', indikator: 'Dilakukan dibidang INFOKOM (>= 70%)', realisasi: 100.0, target: 70.0, satuan: '%' },
            { kode: 'IKT.I.5.i', indikator: 'Minimum Prodi memiliki 1 HKI setiap tahun', realisasi: 0.0, target: 1.0, satuan: ' HKI' },
            { kode: 'IKT.I.5.j', indikator: 'Minimum 70% PkM melibatkan minimal 1 mahasiswa', realisasi: 0.0, target: 70.0, satuan: '%' }
        ];

        // 4. Proses data: Hitung Skor Normalisasi (0-100)
        kpiData.forEach(kpi => {
            let skor = 0;
            const { kode, realisasi, target } = kpi;

            if (kode === 'PGB.I.5.6' || kode === 'PGB.I.7.9') { // KPI Pertumbuhan
                const batasBawah = -10.0; // Asumsi performa terburuk adalah penurunan 10%
                const rentang = target - batasBawah;
                if (rentang > 0) {
                    skor = ((realisasi - batasBawah) / rentang) * 100;
                }
            } else if (kode === 'IKT.I.5.i') { // KPI Biner (Lulus/Gagal)
                skor = (realisasi >= target) ? 100 : 0;
            } else { // KPI Standar
                if (target > 0) {
                    skor = (realisasi / target) * 100;
                }
            }
            // Batasi skor agar selalu dalam rentang 0-100 untuk visualisasi
            kpi.skor_normalisasi = Math.max(0, Math.min(skor, 100));
        });

        // 5. Siapkan data untuk Chart.js
        const kpiLabelsMap = {
            'PGB.I.1.1': 'Luaran Sesuai',
            'PGB.I.5.6': 'Peningkatan PkM',
            'PGB.I.7.4': 'Dana Eksternal',
            'PGB.I.7.9': 'Proposal Diterima',
            'IKT.I.5.g': 'Digunakan di PBM',
            'IKT.I.5.h': 'Bidang INFOKOM',
            'IKT.I.5.i': 'HKI per Prodi',
            'IKT.I.5.j': 'Keterlibatan Mhs.'
        };
        
        const labels = kpiData.map(kpi => kpiLabelsMap[kpi.kode]);
        const actualScores = kpiData.map(kpi => kpi.skor_normalisasi);
        const targetScores = kpiData.map(() => 100);

        // 6. Inisialisasi Chart
        const ctx = document.getElementById('kpiRadarChart').getContext('2d');
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Capaian',
                    data: actualScores,
                    fill: true,
                    backgroundColor: 'rgba(78, 115, 223, 0.2)',
                    borderColor: 'rgb(78, 115, 223)',
                    pointBackgroundColor: 'rgb(78, 115, 223)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgb(78, 115, 223)'
                }, {
                    label: 'Target',
                    data: targetScores,
                    fill: false,
                    borderColor: 'rgba(246, 194, 62)',
                    borderDash: [5, 5],
                    pointRadius: 0,
                    pointHoverRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    r: {
                        min: 0,
                        max: 100,
                        ticks: {
                            stepSize: 20,
                            backdropColor: 'transparent',
                            callback: value => value + '%'
                        },
                        pointLabels: {
                            font: { size: 12 }
                        }
                    }
                },
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        callbacks: {
                            title: context => kpiData[context[0].dataIndex].indikator,
                            label: context => {
                                const kpi = kpiData[context.dataIndex];
                                let persentaseCapaian = 0;
                                if (kpi.target > 0) {
                                    persentaseCapaian = (kpi.realisasi / kpi.target) * 100;
                                }
                                
                                let statusLabel = `(${persentaseCapaian.toFixed(1)}% dari Target)`;
                                if (kpi.skor_normalisasi >= 100 && persentaseCapaian > 100) {
                                    statusLabel = `(Terlampaui: ${persentaseCapaian.toFixed(1)}%)`;
                                }

                                const skor = `Skor Capaian: ${kpi.skor_normalisasi.toFixed(1)}%`;
                                const realisasi = `Realisasi: ${kpi.realisasi}${kpi.satuan} ${statusLabel}`;
                                const target = `Target: ${kpi.target}${kpi.satuan}`;

                                return [skor, realisasi, target];
                            }
                        }
                    }
                }
            }
        });
    </script>

</body>
</html>